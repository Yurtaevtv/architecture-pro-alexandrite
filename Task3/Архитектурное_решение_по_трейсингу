Что нужно покрыть трейсингом:

    - InternetShop
        Входная точка, где формируется заказ и отправляется загруженный файл в харнилище
    - Shop-Api 
        Получает запрос от интернет магазина, формирует заказ и отправляет его в CRM
    - Crm-Api
        Формируется новый заказ и отправляется на работу в Mes-Api
    - MES-Frontend
        Интерфейс для операторов, которые выполняют заказы. 
        На нем отображается информация о заказе, его статусе и так далее.
    - MES-Api
        Получает уведомление, что появился новый заказ на обработку и начинается подсчет цены. 
        Также получает уведомление, что заказ выполнен и нужно обновить его статус.

    Точки, где заказ может сломаться:
        - ShopApi может не записать заказ, в результате чего цепочка прервется
        - MES-Api долго обрабывает заказ
        - Crm-Api не смогла по какой-то причине отправить заказ на обработку в MES-Api через RabbitMQ

Что должно попадать в трейсинг:
    - trace_id - Связь между событями
    _ span_id - Идентификатор конкретного события
    - timestamp - Временная метка события
    - duration - Длительность события
    - status - Статус события (успех/ошибка)
    - service_name - Название сервиса, в котором произошло событие
    - context - Дополнительная информация о событии (например, ID заказа, тип операции и так далее)


Мотивация

    Благодаря внедрению трейсинга, можно будет ответить на следующие вопросы:
    - Сколько времени занимает выполнение заказа от момента его создания до завершения?
    - Где чаще всего возникают задержки в процессе выполнения заказа?
    - Какие партнеры создают наибольшую нагрузку на систему?

    Ответы на эти вопросы позволят сформировать 
    - реалистичные сроки
    - увеличить репутацию компании
    - тарифы для партнеров, которые создают большую нагрузку на систему.


Предлагаемые решения
    Внедрение трейсинга через OpenTelemetry/Jaeger для отслеживания сквозных процессов по заказам. 
    На диаграмме показано, какие сервисы должны быть покрыты трейсингом.


Компромимы
    Внедрение трейсинга в работу баз данных не имеет смысла. Трейсинг должен покрывать только те сервисы, которые участвуют в процессе выполнения заказа.
    В базах данных есть другие инструменты для мониторинга, которые позволяют отслеживать производительность и выявлять проблемы.
    
    Также внедрение трейсинга в работу брокера сообщений RabbitMQ может быть избыточным, так как он не является узким местом в процессе выполнения заказа.
    Наблюдение за работой RabbitMQ выполняется через внутренний мониторнг, а настройки через его конфигурацию. Внедрение OpenTelemtry избыточен в данной ситуации.

    Данные по трейсингу нужно хранить не более 30 дней. Этого достаточно для выполнения анализа и решения проблем. 

Безопасность трейсинга
    Доступ к системам трейсинга есть только у администраторов(продакт-менеджер, тимлид и менеджеры по продажам). 
    В случае выявления инцидентов администратор может выгрузить соответствующие данные или выделить временный доступ, если это необходимо, разрабочикам для решения проблемы.


Дополнительное задание

    Внедряется Prometheus для сбора метрик и оповещения об аномальной активности. 
    OpenTelemetry выступает, как мост, который отрпавляет метрики в Prometheus.
    Prometheus на основе собранных метрик формирует оповещения, которые отправляются в Telegram-канал для оперативного реагирования на возникающие проблемы.

    Например:
        - Если время расчета цены превышает 15 минут, то предупреждение в общий telegram поддержки.
        - Если время расчета цены превышает 30 минут, то отправляется по почте Администратору.

        - Если время отклика магазина увеличилось до 5 секунд, то предупреждение в общий telegram поддержки.
        - Если время отклика магазина увеличилось до 15 секунд, то отправляется по почте Администратору.

        - Если количество сообщений в очереди RabbitMQ превышает 50, то предупреждение в общий telegram поддержки.       
        - Если количество сообщений в очереди RabbitMQ превышает 100, то отправляется по почте Администратору.