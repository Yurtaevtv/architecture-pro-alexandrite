Какие логи собираются
    Уровня Fatal
        Непредевиденное окончание работы сервиса должно логироваться данным уровнем и выдавать детальную ифнормацию по всем StackTract ошибки. 
        Ошибка должна отправлять уведомление администрации и быть быстро решена
    Уровня Error
        InternetShop/ CRM/ MES - должны логировать выдаваемые ошибки на уровне интерфейса. 
    Уровня Info
        Shop-api
            - Информация о создании заказа
                - Идентификатор заказа
                - Статус
                - Описание заказа
        CRM-Api
            - Изменение статуса заказа
                - Идентификатор заказа
                - Текущий статус
                - Предыдущий статус
                - Контекст изменения статуса (например, причина изменения)
            - Запрос на чтение данных
                - Тип запроса (например, получение информации о заказе)
                - Идентификатор заказа
                - Статус запроса (успех/ошибка)
            - Запрос на изменение данных
                - Тип запроса (например, обновление информации о заказе)
                - Идентификатор заказа
                - Статус запроса (успех/ошибка)
        MES-Api
            - Запрос на получение данных
                - Тип запроса (например, получение информации о заказе)
                - Идентификатор заказа
                - Статус запроса (успех/ошибка)
                - Данные заказа
            - Текущий статус заказа
                - Идентификатор заказа
                - Текущий статус
            - Прогресс расчет цены по заказу
                - Идентификатор заказа
                - Текущий процент подсчета
            - Начало работы оператора
                - Идентификатор заказа
                - Идентификатор оператора
                - Временная метка начала работы
            - Завершение работы оператора
                - Идентификатор заказа
                - Идентификатор оператора
                - Временная метка завершения работы
            - Опертор сообщает о проблеме с заказом
                - Идентификатор заказа
                - Идентификатор оператора
                - Описание проблемы
                - Временная метка сообщения о проблеме
    Уровня Debug
        Debug уровень логирования может быть полезен для разработки и отладки, но не должен использоваться в продакшене.
        В продакшене рекомендуется использовать уровни логирования Info, Warning и Error для обеспечения оптимальной производительности и удобства анализа логов. 
        Логи уровня Debug могут содержать подробную информацию о внутреннем состоянии приложения, которая может быть полезна для разработчиков, но может создавать избыточный объем данных и снижать производительность в продакшене.
    Уровня Trace
        Trace уровень логирования может быть полезен для отслеживания выполнения кода и выявления узких мест, но не должен использоваться в продакшене.
 


 Мотивация
    Логирование отвечает на следующие вопросы: 
        - Что именно пошло не так? (стектрейс ошибки, некорректные данные)
        - Кто и когда это сделал? (действия операторов, менеджеров)
        - Какие данные были в момент сбоя? (тело запроса, параметры)
        - Что происходило до и после? (контекст инцидента)
    Без логирования компания:
        - Не может доказать партнёрам, что их заказы были получены
        - Тратит часы на поиск причин конкретного сбоя
        - Не знает, какие действия операторов привели к задержкам
        - Слеп в моментах, где трейсинг не помогает (ошибки валидации, бизнес-логика)

    (Бизнес )В первую очередь логирование позволит: 
        - Снижение количества потерянных заказов
            Логирование поможет выявлять и устранять проблемы, которые могут приводить к потере заказов, что способствует увеличению выручки.
        - Повышение репутации компании
            Появляется возможность доказать партнерам, что заказы были получены и поступили в работу или доказать, что проблемы возникли не по вине компании, что способствует укреплению доверия и улучшению репутации.
        - Оптимизировать работу операторов
            Действия каждого оператора становятся прозрачными, что позволяет выявлять и устранять проблемы в их работе, а также оптимизировать процессы и улучшить производительность.
    
    (Тех )В первую очередь логирование позволит: 
        - Быстро реагировать на возникающие проблемы. 
            Что ускоряет восстановление сервиса и минимизирует негативное влияние на клиентов.
        - Качественное выяление ошибок
            Быстрое и активное исправление ошибок
        - Сокращается количество невыявленных проблем
            Увеличивается стабильность и надежность сервиса, что способствует улучшению пользовательского опыта и повышению доверия клиентов.


    Какой сервис логировать в первую очередь?
        - RabbitMQ
            Все входящие и исходящие сообщения (с телом)	
            Здесь теряются заказы, проблемы интеграции
        - Shop-api
            Создание заказа
            Причина: необходимо отслеживать все этапы жизненного цикла заказа. Его создание - ключевой момент
        - CRM API	
            Подтверждение, закрытие заказа
            Причина: Возможность отслеживать жизненный цикл заказа
        - Price Calculator	
            Начало и конец расчёта, ошибки, время	Самое
            Причина: данный сервис - самое узкое место, частые сбои




Предлагаемое решение
    Предложение: 
        - OpenTelemtry Collector 
            - Единая точка сбора метрик и логов 
        -  Сбор и хранение логов в Loki
            - Централизованное хранилище логов
            - Возможность масштабирования и высокой доступности
        - Визуализация логов в Grafana
            - Удобный интерфейс для анализа логов

        В локальном drawio файле отображено желтым цветом внедрение логирования

    Безопасность логово
        В логах не должно быть персональных данных клиентов и сотрудников.
            Email	Маскировка: j***@gmail.com
            Телефон	Маскировка: +7***1234
            Адрес	Маскировка: удаляем номер дома/квартиры
            Токены	Полное удаление из логов

    Политика хранения логов
        Логи хранятся не более 30 дней, после чего автоматически удаляются

    Система анализа логов
        Необходимо внедрить систему анализа и оповещения на основе логов. Это поможет своевременно и быстро выялять проблемы, которые нужно устронять.
        Проблемы технического характера:
            - Большое количество ошибок 500+: Множество ошибок является признаком проблем с сервером, которые требуют немедленного внимания.
            - Увеличение времени ответа: Если время ответа сервиса значительно увеличивается, это может указывать на проблемы с производительностью, которые нужно решить.
            - Очередь сообщений в RabbitMQ: Если очередь сообщений начинает расти, это может указывать на проблемы с обработкой сообщений, которые нужно решить.
        Проблемы бизнес-логики:
            - Рост число ошибока по партнерам
            - Зависшие заказы: заказ находится в одном и том же статусе слишком долго
            - аномальное время расчета цены

Сравнение технологий

Ресурсы:
    Технология	        Стоимость лицензий	Ресурсы             	Стоимость хранения      	    Операционные расходы

    ELK (Open Source)	Бесплатно	        Высокие (ES тяжелый)	Высокая (реплики, шарды)	    Средние
    ELK (Elastic Cloud)	Платная	            Оптимизирована	        Зависит от тарифа	            Низкие
    Loki	            Бесплатно	        Низкие              	Низкая (объектное хранилище)	Низкие
    Graylog         	Бесплатно	        Средние             	Средняя	                        Средние 
    Splunk          	Очень дорого	    Высокие             	Очень высокая	                Низкие (поддержка вендора)
    OpenTelemetry + ELK	Бесплатно	        Средние             	Средняя	                        Средние

Возможности: 
    Технология	        Полнотекстовый поиск	                Поиск по полям	        Скорость	        Аналитика
    ELK	                ✅ Отличный (инвертированный индекс)	    ✅ Отличный	            Быстрый	            ✅ Aggregations, ML
    Loki	            ⚠️ Ограниченный (только по лейблам)	     ✅ По лейблам	         Очень быстрый	     ⚠️ LogQL ограничен
    Graylog	            ✅ Хороший	                            ✅ Хороший	            Средний	            ✅ Есть
    Splunk	            ✅ Отличный (Splunk Search)	            ✅ Отличный	            Быстрый	            ✅ SPL, ML
    OpenTelemetry + ELK	✅ Отличный	                            ✅ Отличный	            Быстрый	            ✅ Полный ELK
